<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AttendanceTrack – AI-Powered Smart Attendance System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        purple: {
                            50: '#f5f3ff', 100: '#ede9fe', 200: '#ddd6fe', 300: '#c4b5fd',
                            400: '#a78bfa', 500: '#8b5cf6', 600: '#7c3aed', 700: '#6d28d9',
                            800: '#5b21b6', 900: '#4c1d95'
                        }
                    },
                    fontFamily: { sans: ['Inter', 'system-ui', 'sans-serif'] },
                    boxShadow: {
                        glass: '0 8px 32px rgba(139, 92, 246, 0.12)',
                        card: '0 20px 40px rgba(0,0,0,0.06)',
                        soft: '0 10px 30px rgba(139, 92, 246, 0.1)'
                    }
                }
            }
        }
    </script>

    <style>
        body { font-family: 'Inter', sans-serif; }
        .glass { background: rgba(255, 255, 255, 0.75); backdrop-filter: blur(16px); border: 1px solid rgba(255, 255, 255, 0.4); }
        .hero-glass { background: rgba(255, 255, 255, 0.88); backdrop-filter: blur(20px); border: 1px solid rgba(139, 92, 246, 0.15); }

        .feature-card {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .feature-card:hover {
            transform: translateY(-16px);
            box-shadow: 0 25px 50px rgba(139, 92, 246, 0.18);
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(3deg); }
        }
        .float { animation: float 12s ease-in-out infinite; }
        .delay-700 { animation-delay: 0.7s; }
        .delay-1000 { animation-delay: 1s; }

        .text-gradient {
            background: linear-gradient(to right, #8b5cf6, #a78bfa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 10px; }
        ::-webkit-scrollbar-thumb { background: #8b5cf6; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #7c3aed; }
    </style>
</head>
<body class="bg-gray-50 text-gray-900 overflow-x-hidden">

    <!-- Navigation -->
    <header class="fixed top-0 w-full z-50 glass border-b border-gray-200/50 backdrop-blur-xl">
        <nav class="max-w-7xl mx-auto px-6 py-5 flex items-center justify-between">
            <div class="flex items-center space-x-3">
                <div class="w-12 h-12 rounded-2xl bg-gradient-to-br from-purple-600 to-purple-700 flex items-center justify-center shadow-lg">
                    <i class="fas fa-graduation-cap text-white text-xl"></i>
                </div>
                <span class="text-2xl font-bold text-gray-900">AttendanceTrack</span>
            </div>

            <ul class="hidden lg:flex items-center space-x-10 font-medium text-gray-700">
                <li><a href="#features" class="hover:text-purple-600 transition">Features</a></li>
                <li><a href="#how-it-works" class="hover:text-purple-600 transition">How It Works</a></li>
                <li><a href="#analytics" class="hover:text-purple-600 transition">Analytics</a></li>
                <li><a href="#solutions" class="hover:text-purple-600 transition">Solutions</a></li>
            </ul>

            <div class="flex items-center space-x-4">
                {% if user.is_authenticated and request.user.is_superuser %}
                    <a href="{% url 'face_dashboard' %}" class="px-6 py-3 bg-purple-600 text-white rounded-full font-semibold hover:bg-purple-700 transition">
                        <i class="fas fa-tachometer-alt mr-2"></i>Dashboard
                    </a>
                {% else %}
                    <button data-open-modal="login" class="font-medium text-gray-700 hover:text-purple-600">Login</button>
                    <button data-open-modal="signup" class="px-7 py-3 bg-purple-600 text-white rounded-full font-bold hover:bg-purple-700 hover:shadow-xl transition transform hover:scale-105">
                        Get Started
                    </button>
                {% endif %}
            </div>
        </nav>
    </header>

    <!-- Hero Section – Pure White, Clean & Elegant -->
    <section class="min-h-screen flex items-center relative bg-white overflow-hidden">
        <!-- Subtle blurred orbs -->
        <div class="absolute inset-0 pointer-events-none opacity-40">
            <div class="absolute top-20 left-20 w-96 h-96 bg-purple-300/30 rounded-full blur-3xl animate-pulse"></div>
            <div class="absolute bottom-32 right-32 w-80 h-80 bg-purple-400/20 rounded-full blur-3xl animate-pulse delay-1000"></div>
            <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-[700px] h-[700px] bg-purple-200/10 rounded-full blur-3xl"></div>
        </div>

        <!-- Minimal particles -->
        <div id="particles-js" class="absolute inset-0 opacity-20"></div>

        <div class="max-w-7xl mx-auto px-6 grid lg:grid-cols-2 gap-16 items-center relative z-10 pt-32 pb-20">
            <div class="space-y-10">
                <div class="inline-flex items-center space-x-3 bg-purple-100 text-purple-700 px-6 py-3 rounded-full text-sm font-semibold">
                    <span class="w-2 h-2 bg-purple-600 rounded-full animate-pulse"></span>
                    <span>Next-Gen Campus Intelligence</span>
                </div>

                <h1 class="text-5xl lg:text-7xl font-extrabold leading-tight text-gray-900">
                    Smart Attendance,<br/>
                    <span class="text-gradient">Smarter Campus</span>
                </h1>

                <p class="text-xl text-gray-600 leading-relaxed max-w-xl">
                    Transform your institution with AI-powered face recognition, real-time occupancy tracking, and intelligent analytics — all in one seamless platform.
                </p>

                <div class="flex flex-wrap gap-5 pt-4">
                    <a href="#features" class="px-8 py-4 bg-purple-600 text-white rounded-2xl font-bold text-lg shadow-lg hover:bg-purple-700 hover:shadow-purple-600/30 transition transform hover:scale-105">
                        Explore Features
                    </a>
                    <a href="#demo" class="px-8 py-4 bg-gray-100 text-gray-800 rounded-2xl font-semibold hover:bg-gray-200 transition flex items-center">
                        <i class="fas fa-play mr-3"></i>Watch Demo
                    </a>
                </div>

                <div class="flex items-center gap-12 pt-10">
                    <div>
                        <div class="text-4xl font-bold text-gray-900">99.8%</div>
                        <div class="text-gray-600">Recognition Accuracy</div>
                    </div>
                    <div>
                        <div class="text-4xl font-bold text-gray-900">50K+</div>
                        <div class="text-gray-600">Active Students</div>
                    </div>
                    <div>
                        <div class="text-4xl font-bold text-gray-900">24/7</div>
                        <div class="text-gray-600">Real-Time Monitoring</div>
                    </div>
                </div>
            </div>

            <!-- Floating Feature Cards -->
            <div class="relative">
                <div class="grid grid-cols-2 gap-8">
                    <div class="space-y-8">
                        <div class="hero-glass p-8 rounded-3xl feature-card float shadow-lg">
                            <div class="w-16 h-16 bg-gradient-to-br from-purple-500 to-purple-600 rounded-2xl flex items-center justify-center text-white text-3xl mb-5">
                                <i class="fas fa-user-check"></i>
                            </div>
                            <h3 class="text-xl font-bold text-gray-900">Instant Attendance</h3>
                            <p class="text-gray-600">Face recognition in under 1 second</p>
                        </div>
                        <div class="hero-glass p-8 rounded-3xl feature-card float delay-700">
                            <div class="w-16 h-16 bg-gradient-to-br from-purple-500 to-purple-600 rounded-2xl flex items-center justify-center text-white text-3xl mb-5">
                                <i class="fas fa-bell"></i>
                            </div>
                            <h3 class="text-xl font-bold text-gray-900">Smart Alerts</h3>
                            <p class="text-gray-600">Overcapacity & anomaly detection</p>
                        </div>
                    </div>
                    <div class="space-y-8 pt-16">
                        <div class="hero-glass p-8 rounded-3xl feature-card float delay-1000">
                            <div class="w-16 h-16 bg-gradient-to-br from-purple-500 to-purple-600 rounded-2xl flex items-center justify-center text-white text-3xl mb-5">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <h3 class="text-xl font-bold text-gray-900">Live Analytics</h3>
                            <p class="text-gray-600">Real-time insights & reports</p>
                        </div>
                        <div class="hero-glass p-8 rounded-3xl feature-card float">
                            <div class="w-16 h-16 bg-gradient-to-br from-purple-500 to-purple-600 rounded-2xl flex items-center justify-center text-white text-3xl mb-5">
                                <i class="fas fa-mobile-alt"></i>
                            </div>
                            <h3 class="text-xl font-bold text-gray-900">Mobile Access</h3>
                            <p class="text-gray-600">Admin & faculty apps included</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Features -->
    <section id="features" class="py-24 bg-white">
        <div class="max-w-7xl mx-auto px-6 text-center">
            <h2 class="text-5xl font-extrabold text-gray-900 mb-6">Powerful Features for Modern Campuses</h2>
            <p class="text-xl text-gray-600 max-w-3xl mx-auto">Everything you need to automate attendance, ensure safety, and optimize space usage.</p>

            <div class="grid md:grid-cols-3 gap-10 mt-20">
                <div class="text-center group">
                    <div class="w-24 h-24 mx-auto bg-gradient-to-br from-purple-500 to-purple-700 rounded-3xl flex items-center justify-center text-white text-5xl shadow-2xl group-hover:scale-110 transition">
                        <i class="fas fa-camera"></i>
                    </div>
                    <h3 class="text-2xl font-bold mt-8 mb-4">AI Face Recognition</h3>
                    <p class="text-gray-600">99.8% accurate, works in all lighting conditions, supports 1000+ faces per camera</p>
                </div>
                <div class="text-center group">
                    <div class="w-24 h-24 mx-auto bg-gradient-to-br from-purple-600 to-pink-600 rounded-3xl flex items-center justify-center text-white text-5xl shadow-2xl group-hover:scale-110 transition">
                        <i class="fas fa-users"></i>
                    </div>
                    <h3 class="text-2xl font-bold mt-8 mb-4">Crowd Density Tracking</h3>
                    <p class="text-gray-600">Real-time headcount, heatmaps, and overcapacity alerts for safety compliance</p>
                </div>
                <div class="text-center group">
                    <div class="w-24 h-24 mx-auto bg-gradient-to-br from-indigo-500 to-purple-600 rounded-3xl flex items-center justify-center text-white text-5xl shadow-2xl group-hover:scale-110 transition">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <h3 class="text-2xl font-bold mt-8 mb-4">Privacy-First Design</h3>
                    <p class="text-gray-600">GDPR compliant, encrypted storage, no biometric data sharing</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Analytics Preview -->
    <section id="analytics" class="py-24 bg-gradient-to-b from-purple-50 to-white">
        <div class="max-w-7xl mx-auto px-6 grid lg:grid-cols-2 gap-16 items-center">
            <div>
                <h2 class="text-5xl font-extrabold text-gray-900 mb-6">Real-Time Insights at Your Fingertips</h2>
                <p class="text-xl text-gray-600 mb-10">Monitor attendance trends, optimize classroom usage, and make data-driven decisions instantly.</p>
                <div class="space-y-6">
                    <div class="flex items-start space-x-5">
                        <div class="w-12 h-12 bg-purple-600 rounded-xl flex items-center justify-center text-white text-2xl"><i class="fas fa-check"></i></div>
                        <div>
                            <h4 class="font-bold text-lg">Live Dashboard</h4>
                            <p class="text-gray-600">See attendance and occupancy across all classrooms in real time</p>
                        </div>
                    </div>
                    <div class="flex items-start space-x-5">
                        <div class="w-12 h-12 bg-purple-600 rounded-xl flex items-center justify-center text-white text-2xl"><i class="fas fa-check"></i></div>
                        <div>
                            <h4 class="font-bold text-lg">Export Reports</h4>
                            <p class="text-gray-600">Download PDF/Excel reports for accreditation and audits</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-3xl shadow-2xl p-8 border border-purple-100">
                <img src="https://images.unsplash.com/photo-1551288048-9b4ecp3d8e?q=80&w=800&auto=format&fit=crop" alt="Analytics Dashboard" class="rounded-2xl shadow-xl w-full">
            </div>
        </div>
    </section>

    <!-- Solutions -->
    <section id="solutions" class="py-24 bg-gray-50">
        <div class="max-w-7xl mx-auto px-6 text-center">
            <h2 class="text-5xl font-extrabold mb-6">Complete Campus Solutions</h2>
            <div class="grid md:grid-cols-3 gap-10 mt-16">
                <div class="bg-white rounded-3xl p-10 shadow-glass card-hover border border-purple-100 feature-card">
                    <div class="text-6xl mb-6 text-purple-600">A</div>
                    <h3 class="text-2xl font-bold mb-4">Automated Attendance</h3>
                    <p class="text-gray-600">Face recognition at entry points with session-based logging</p>
                </div>
                <div class="bg-gradient-to-br from-purple-600 to-purple-800 text-white rounded-3xl p-10 shadow-2xl feature-card transform scale-105">
                    <div class="text-6xl mb-6">U</div>
                    <h3 class="text-2xl font-bold mb-4">Unknown Face Marking</h3>
                    <p>Detect and flag unrecognized individuals for security and safety monitoring</p>
                </div>
                <div class="bg-white rounded-3xl p-10 shadow-glass card-hover border border-purple-100 feature-card">
                    <div class="text-6xl mb-6 text-purple-600">N</div>
                    <h3 class="text-2xl font-bold mb-4">Urgent Notification</h3>
                    <p class="text-gray-600">Real-time alerts for critical attendance anomalies and security concerns</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-gray-900 text-white py-20">
        <div class="max-w-7xl mx-auto px-6 grid md:grid-cols-4 gap-10">
            <div>
                <div class="flex items-center space-x-3 mb-6">
                    <div class="w-12 h-12 rounded-2xl bg-gradient-to-br from-purple-600 to-purple-700 flex items-center justify-center">
                        <i class="fas fa-graduation-cap text-2xl"></i>
                    </div>
                    <span class="text-2xl font-bold">AttendanceTrack</span>
                </div>
                <p class="text-gray-400">Reimagining campus management with AI and automation.</p>
            </div>
            <div>
                <h4 class="font-bold mb-4">Product</h4>
                <ul class="space-y-3 text-gray-400">
                    <li><a href="#" class="hover:text-white">Features</a></li>
                    <li><a href="#" class="hover:text-white">Pricing</a></li>
                    <li><a href="#" class="hover:text-white">Security</a></li>
                </ul>
            </div>
            <div>
                <h4 class="font-bold mb-4">Company</h4>
                <ul class="space-y-3 text-gray-400">
                    <li><a href="#" class="hover:text-white">About</a></li>
                    <li><a href="#" class="hover:text-white">Blog</a></li>
                    <li><a href="#" class="hover:text-white">Careers</a></li>
                </ul>
            </div>
            <div>
                <h4 class="font-bold mb-4">Get Started Today</h4>
                <button data-open-modal="signup" class="w-full py-4 bg-gradient-to-r from-purple-600 to-purple-700 rounded-2xl font-bold hover:opacity-90 transition">
                    Start Free Trial
                </button>
            </div>
        </div>
        <div class="text-center text-gray-500 text-sm mt-12 pt-8 border-t border-gray-800">
            © 2025 AttendanceTrack. All rights reserved.
        </div>
    </footer>

    <!-- tsParticles -->
    <script src="https://cdn.jsdelivr.net/npm/tsparticles@2/tsparticles.bundle.min.js"></script>
    <script>
        tsParticles.load("particles-js", {
            fullScreen: { enable: false },
            particles: {
                number: { value: 50, density: { enable: true } },
                color: { value: "#c4b5fd" },
                shape: { type: "circle" },
                opacity: { value: 0.15, random: true },
                size: { value: { min: 1, max: 4 } },
                links: { enable: true, distance: 150, color: "#c4b5fd", opacity: 0.1 },
                move: { enable: true, speed: 0.6 }
            },
            interactivity: { events: { onHover: { enable: true, mode: "repulse" } } },
            retina_detect: true
        });
    </script>

    <!-- Full Modal with Login/Signup -->
    <div id="auth-modal" aria-hidden="true" class="fixed inset-0 z-50 hidden items-center justify-center px-4">
        <div id="auth-overlay" class="absolute inset-0 bg-black/40 backdrop-blur-sm"></div>
        <div class="relative modal-card bg-white rounded-2xl shadow-soft-lg w-full max-w-lg mx-auto overflow-visible transition-transform duration-200 ease-out opacity-0 scale-95">
            <button id="auth-close" class="absolute right-3 top-3 text-slate-500 hover:text-slate-700"><span class="sr-only">Close</span>×</button>
            <div class="pt-6 p-6">
                <div class="absolute -top-10 left-1/2 transform -translate-x-1/2">
                    <div id="signup-avatar-container" class="h-20 w-20 rounded-full bg-gradient-to-br from-purple-500 to-purple-600 flex items-center justify-center text-white shadow-lg border-4 border-white overflow-hidden" tabindex="0" role="button">
                        <img id="signup-avatar-preview" src="" alt="avatar preview" class="hidden h-full w-full object-cover">
                        <i id="login-avatar-fallback" class="fas fa-user fa-2x"></i>
                        <button id="signup-avatar-fallback" type="button" class="text-white text-2xl hidden" aria-label="Choose profile picture">
                            <i class="fas fa-camera"></i>
                        </button>
                        <input type="file" id="signup-avatar" name="avatar" accept="image/*" class="hidden" />
                    </div>
                </div>
                <div class="text-center mt-6">
                    <h3 class="text-lg font-semibold text-slate-900">Welcome back</h3>
                    <p class="text-sm text-slate-500">Sign in or create an account to continue</p>
                </div>

                <div class="flex items-center justify-center space-x-3 mb-4">
                    <button id="auth-login-btn" class="px-4 py-2 rounded-full text-sm font-semibold text-purple-700 bg-purple-50 shadow-sm" aria-pressed="true">Login</button>
                    <button id="auth-signup-btn" class="px-4 py-2 rounded-full text-sm font-semibold text-purple-500 hover:bg-purple-50">Signup</button>
                </div>

                <div class="h-px bg-slate-100 my-3"></div>

                <!-- Login Form -->
                <form id="auth-login" class="space-y-4">
                    <input type="email" id="login-email" placeholder="Email" required class="w-full rounded-xl border border-slate-200 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-purple-400">
                    <input type="password" id="login-pass" placeholder="Password" required class="w-full rounded-xl border border-slate-200 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-purple-400">
                    <div class="flex items-center justify-between">
                        <label class="flex items-center space-x-2 text-sm text-slate-600"><input type="checkbox"> <span>Remember me</span></label>
                        <a href="#" class="text-sm text-purple-600">Forgot?</a>
                    </div>
                    <button type="submit" class="w-full rounded-xl bg-gradient-to-r from-purple-500 to-purple-600 text-white py-3 font-semibold hover:opacity-95">Sign in</button>
                </form>

                <!-- Signup Form -->
                <form id="auth-signup" class="space-y-4 hidden" enctype="multipart/form-data">
                    <div class="grid grid-cols-2 gap-8">
                        <div><input type="text" id="signup-name" name="name" placeholder="Full name" required class="w-full rounded-xl border border-slate-200 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-purple-400"><div id="err-name" class="text-sm text-red-600 hidden mt-1"></div></div>
                        <div><input type="text" id="signup-username" name="username" placeholder="Username" required class="w-full rounded-xl border border-slate-200 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-purple-400"><div id="err-username" class="text-sm text-red-600 hidden mt-1"></div></div>
                    </div>
                    <div><input type="email" id="signup-email" name="email" placeholder="Email" required class="w-full rounded-xl border border-slate-200 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-purple-400"><div id="err-email" class="text-sm text-red-600 hidden mt-1"></div></div>
                    <div class="grid grid-cols-2 gap-8">
                        <div><input type="tel" id="signup-phone" name="phone" placeholder="Phone number" required class="w-full rounded-xl border border-slate-200 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-purple-400"><div id="err-phone" class="text-sm text-red-600 hidden mt-1"></div></div>
                        <div><input type="text" id="signup-studentid" name="student_id" placeholder="Student ID" required class="w-full rounded-xl border border-slate-200 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-purple-400"><div id="err-studentid" class="text-sm text-red-600 hidden mt-1"></div></div>
                    </div>
                    <div>
                        <select id="signup-dept" name="department" required class="w-full rounded-xl border border-slate-200 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-purple-400">
                            <option value="" disabled selected>Select Department</option>
                            <option value="BCA">BCA</option>
                            <option value="BSc">BSc</option>
                            <option value="BCom">BCom</option>
                            <option value="Electronics">Electronics</option>
                        </select>
                        <div id="err-dept" class="text-sm text-red-600 hidden mt-1"></div>
                    </div>
                    <div class="grid grid-cols-2 gap-8">
                        <div><input type="password" id="signup-pass" name="password" placeholder="Password" required class="w-full rounded-xl border border-slate-200 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-purple-400"><div id="err-password" class="text-sm text-red-600 hidden mt-1"></div></div>
                        <div><input type="password" id="signup-pass-confirm" name="password_confirm" placeholder="Confirm Password" required class="w-full rounded-xl border border-slate-200 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-purple-400"><div id="err-password-confirm" class="text-sm text-red-600 hidden mt-1"></div></div>
                    </div>
                    <div id="signup-pass-error" class="text-sm text-red-600 hidden">Passwords do not match</div>
                    <button type="submit" id="signup-submit" class="w-full rounded-xl bg-gradient-to-r from-purple-500 to-purple-600 text-white py-3 font-semibold hover:opacity-95">Create account</button>
                    <div id="signup-general-error" class="text-sm text-red-600 hidden mt-2"></div>
                </form>
            </div>
        </div>
    </div>

    <!-- Full JavaScript (Modal + Forms + Validation + AJAX) -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const modal = document.getElementById('auth-modal');
            const overlay = document.getElementById('auth-overlay');
            const btnClose = document.getElementById('auth-close');
            const loginForm = document.getElementById('auth-login');
            const signupForm = document.getElementById('auth-signup');
            const loginTab = document.getElementById('auth-login-btn');
            const signupTab = document.getElementById('auth-signup-btn');
            const modalCard = modal.querySelector('.modal-card');

            function openModal(mode) {
                modal.classList.remove('hidden'); modal.classList.add('flex');
                modal.setAttribute('aria-hidden', 'false');
                requestAnimationFrame(() => {
                    modalCard.classList.remove('opacity-0', 'scale-95');
                    modalCard.classList.add('opacity-100', 'scale-100');
                });
                mode === 'signup' ? showSignup() : showLogin();
                setTimeout(() => document.getElementById(mode === 'signup' ? 'signup-name' : 'login-email')?.focus(), 120);
            }

            function closeModal() {
                modalCard.classList.add('opacity-0', 'scale-95');
                modalCard.classList.remove('opacity-100', 'scale-100');
                setTimeout(() => { modal.classList.add('hidden'); modal.classList.remove('flex'); modal.setAttribute('aria-hidden', 'true'); }, 220);
            }

            let avatarEnabled = false;
            const avatarInput = document.getElementById('signup-avatar');
            const avatarPreview = document.getElementById('signup-avatar-preview');

            function showLogin() {
                loginForm.classList.remove('hidden'); signupForm.classList.add('hidden');
                loginTab.classList.add('text-purple-700', 'bg-purple-50'); loginTab.classList.remove('text-purple-500');
                signupTab.classList.remove('text-purple-700', 'bg-purple-50'); signupTab.classList.add('text-purple-500');
                avatarEnabled = false;
                document.getElementById('login-avatar-fallback')?.classList.remove('hidden');
                document.getElementById('signup-avatar-fallback')?.classList.add('hidden');
            }

            function showSignup() {
                signupForm.classList.remove('hidden'); loginForm.classList.add('hidden');
                signupTab.classList.add('text-purple-700', 'bg-purple-50'); signupTab.classList.remove('text-purple-500');
                loginTab.classList.remove('text-purple-700', 'bg-purple-50'); loginTab.classList.add('text-purple-500');
                avatarEnabled = true;
                if (!avatarPreview.classList.contains('hidden')) {
                    document.getElementById('login-avatar-fallback')?.classList.add('hidden');
                    document.getElementById('signup-avatar-fallback')?.classList.add('hidden');
                } else {
                    document.getElementById('login-avatar-fallback')?.classList.add('hidden');
                    document.getElementById('signup-avatar-fallback')?.classList.remove('hidden');
                }
            }

            document.querySelectorAll('[data-open-modal]').forEach(b => b.addEventListener('click', e => openModal(e.target.getAttribute('data-open-modal'))));
            overlay?.addEventListener('click', closeModal);
            btnClose?.addEventListener('click', closeModal);
            document.addEventListener('keydown', e => e.key === 'Escape' && closeModal());
            loginTab?.addEventListener('click', showLogin);
            signupTab?.addEventListener('click', showSignup);

            // Avatar handling
            document.getElementById('signup-avatar-container')?.addEventListener('click', () => avatarEnabled && avatarInput.click());
            avatarInput?.addEventListener('change', function () {
                const file = this.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = e => {
                        avatarPreview.src = e.target.result;
                        avatarPreview.classList.remove('hidden');
                        document.getElementById('login-avatar-fallback')?.classList.add('hidden');
                        document.getElementById('signup-avatar-fallback')?.classList.add('hidden');
                    };
                    reader.readAsDataURL(file);
                }
            });

            // Toast helper
            function showToast(title, message, type = 'info') {
                let container = document.getElementById('toast-area') || (() => {
                    const c = document.createElement('div'); c.id = 'toast-area'; c.style.position = 'fixed'; c.style.top = '18px'; c.style.right = '18px'; c.style.zIndex = 99999; c.style.display = 'flex'; c.style.flexDirection = 'column'; c.style.gap = '10px'; document.body.appendChild(c); return c;
                })();
                const toast = document.createElement('div');
                toast.style.minWidth = '220px'; toast.style.background = type === 'error' ? '#fee2e2' : (type === 'success' ? '#ecfccb' : '#eef2ff');
                toast.style.border = '1px solid rgba(0,0,0,0.06)'; toast.style.padding = '10px 12px'; toast.style.borderRadius = '10px'; toast.style.boxShadow = '0 6px 20px rgba(2,6,23,0.08)';
                toast.innerHTML = `<strong>${title}</strong><div>${message}</div>`;
                container.appendChild(toast);
                setTimeout(() => { toast.style.opacity = '0'; toast.style.transform = 'translateY(-6px)'; setTimeout(() => container.removeChild(toast), 220); }, 4200);
            }

            // Login AJAX
            loginForm?.addEventListener('submit', function (e) {
                e.preventDefault();
                const email = document.getElementById('login-email').value.trim();
                const pass = document.getElementById('login-pass').value;
                const fd = new FormData(); fd.append('email', email); fd.append('password', pass);
                fetch('/login/', { method: 'POST', body: fd, credentials: 'same-origin', headers: { 'X-Requested-With': 'XMLHttpRequest' } })
                    .then(r => r.json().catch(() => r.text()).then(data => ({ status: r.status, body: data })))
                    .then(({ status, body }) => {
                        if (status >= 200 && status < 300 && body.success) {
                            showToast('Welcome', 'Logged in successfully', 'success');
                            setTimeout(() => window.location = body.redirect_url || '/', 800);
                        } else {
                            showToast('Login Failed', body.errors?.non_field_error || body.error || 'Invalid credentials', 'error');
                        }
                    }).catch(() => showToast('Error', 'Network error', 'error'));
            });

            // Signup AJAX + Validation
            signupForm?.addEventListener('submit', function (e) {
                e.preventDefault();
                document.querySelectorAll('#auth-signup [id^="err-"], #signup-pass-error, #signup-general-error').forEach(el => el.classList.add('hidden'));

                const values = {
                    name: document.getElementById('signup-name').value.trim(),
                    username: document.getElementById('signup-username').value.trim(),
                    email: document.getElementById('signup-email').value.trim(),
                    phone: document.getElementById('signup-phone').value.trim(),
                    studentid: document.getElementById('signup-studentid').value.trim(),
                    dept: document.getElementById('signup-dept').value,
                    pass: document.getElementById('signup-pass').value,
                    passConfirm: document.getElementById('signup-pass-confirm').value
                };

                let hasError = false;
                if (!/^[A-Za-z ]+$/.test(values.name)) { document.getElementById('err-name').textContent = 'Only letters and spaces'; document.getElementById('err-name').classList.remove('hidden'); hasError = true; }
                if (/^\d+$/.test(values.username)) { document.getElementById('err-username').textContent = 'Cannot be only numbers'; document.getElementById('err-username').classList.remove('hidden'); hasError = true; }
                if (!values.email.includes('@')) { document.getElementById('err-email').textContent = 'Valid email required'; document.getElementById('err-email').classList.remove('hidden'); hasError = true; }
                if (!/^\d{10}$/.test(values.phone)) { document.getElementById('err-phone').textContent = '10 digits required'; document.getElementById('err-phone').classList.remove('hidden'); hasError = true; }
                if (!/^REG\d{3,}$/.test(values.studentid)) { document.getElementById('err-studentid').textContent = 'Format: REG001'; document.getElementById('err-studentid').classList.remove('hidden'); hasError = true; }
                if (!values.dept) { document.getElementById('err-dept').textContent = 'Select department'; document.getElementById('err-dept').classList.remove('hidden'); hasError = true; }
                if (values.pass.length < 6) { document.getElementById('err-password').textContent = 'Min 6 characters'; document.getElementById('err-password').classList.remove('hidden'); hasError = true; }
                if (values.pass !== values.passConfirm) { document.getElementById('signup-pass-error').classList.remove('hidden'); hasError = true; }

                if (hasError) return;

                const fd = new FormData();
                Object.keys(values).forEach(k => k !== 'passConfirm' && fd.append(k === 'pass' ? 'password' : k === 'studentid' ? 'student_id' : k === 'dept' ? 'department' : k, values[k]));
                if (avatarInput.files[0]) fd.append('avatar', avatarInput.files[0]);

                fetch('/signup/', { method: 'POST', body: fd, credentials: 'same-origin', headers: { 'X-Requested-With': 'XMLHttpRequest' } })
                    .then(r => r.json().catch(() => r.text()).then(data => ({ status: r.status, body: data })))
                    .then(({ status, body }) => {
                        if (status >= 200 && status < 300 && body.success) {
                            showToast('Success', body.redirect_to_capture ? 'Account created! Redirecting...' : 'Account created!', 'success');
                            if (body.redirect_to_capture) setTimeout(() => location.href = '/face-capture/', 1500);
                            else { showLogin(); document.getElementById('login-email').value = values.email; }
                        } else {
                            const errors = body.errors || {};
                            Object.keys(errors).forEach(k => {
                                const el = document.getElementById('err-' + k) || document.getElementById('signup-general-error');
                                if (el) { el.textContent = errors[k]; el.classList.remove('hidden'); }
                            });
                        }
                    }).catch(() => showToast('Error', 'Network error', 'error'));
            });
        });
    </script>
</body>
</html>